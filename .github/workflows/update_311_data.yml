name: Update 311 Police Data

on:
  workflow_dispatch:  # elle tetikleme
  schedule:
    - cron: '0 6 1 * *'  # Her ayın 1'i, 06:00 UTC (San Francisco'da 23:00 önceki gün)

jobs:
  update-311:
    runs-on: ubuntu-latest

    steps:
    - name: 📥 Reponun en son halini klonla
      uses: actions/checkout@v3

    - name: 🐍 Python ortamını hazırla
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: 📦 Gerekli paketleri yükle
      run: |
        pip install pandas geopandas shapely requests fiona pyproj rtree

    - name: 🚀 311 verisini güncelle (update_311_data.py)
      run: |
        python scripts/update_311_data.py

    - name: 🔄 Çıktı dosyalarını GitHub'a ekle
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@users.noreply.github.com"
        git add crime_data/sf_311_last_5_years.csv
        git add crime_data/311_requests_range.csv
        git add crime_data/sf_crime_04.csv
        git commit -m "🔄 311 verisi otomatik güncellendi: $(date -u +'%Y-%m-%d %H:%M:%S')"
        git push
